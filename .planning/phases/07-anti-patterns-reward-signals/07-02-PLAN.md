---
phase: 07-anti-patterns-reward-signals
plan: 02
type: execute
wave: 2
depends_on:
  - 07-01
files_modified:
  - skills/ac-status/SKILL.md
autonomous: true
requirements:
  - RWRD-04

must_haves:
  truths:
    - "/ac-status displays reward signal breakdown with implicit and explicit counts"
    - "/ac-status shows average reward score and recent trend from last 5 sessions"
    - "/ac-status shows anti-pattern breakdown by source type (explicit, correction, error)"
  artifacts:
    - path: "skills/ac-status/SKILL.md"
      provides: "Updated status dashboard with reward signals and anti-pattern source breakdown"
      contains: "Reward Signals"
  key_links:
    - from: "skills/ac-status/SKILL.md"
      to: ".auto-context/rewards.json"
      via: "jq reads reward history for aggregation"
      pattern: "rewards\\.json"
    - from: "skills/ac-status/SKILL.md"
      to: ".auto-context/anti-patterns.json"
      via: "jq reads anti-patterns grouped by source"
      pattern: "anti-patterns\\.json.*source"
---

<objective>
Update the /ac-status skill to display reward signal quality breakdown and anti-pattern source categorization, replacing the Phase 7 placeholder with live data.

Purpose: Give users visibility into signal quality (implicit vs explicit, positive vs negative) and anti-pattern sources (explicit feedback, correction detection, error tracking) so they can evaluate how well auto-context is learning.
Output: Updated ac-status SKILL.md with reward signal display and anti-pattern breakdown sections.
</objective>

<execution_context>
@/Users/dgsw67/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dgsw67/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-anti-patterns-reward-signals/07-RESEARCH.md
@.planning/phases/07-anti-patterns-reward-signals/07-01-SUMMARY.md

@skills/ac-status/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update /ac-status with reward signal display and anti-pattern breakdown</name>
  <files>skills/ac-status/SKILL.md</files>
  <action>
Modify `skills/ac-status/SKILL.md` to replace the placeholder reward section and enhance the anti-pattern section with source breakdown.

**Step 1: Update Step 1 (Read Pipeline Data) to include rewards.json:**

Add `rewards.json` to the list of files to read:
```
- `rewards.json` -- per-session reward signal history
```

**Step 2: Update Step 2 (Gather Counts) to add reward and anti-pattern source queries:**

Add these jq commands to the existing command list:

```bash
# Anti-pattern breakdown by source
jq '[.[] | select(.source == "explicit")] | length' .auto-context/anti-patterns.json
jq '[.[] | select(.source == "correction")] | length' .auto-context/anti-patterns.json
jq '[.[] | select(.source == "error")] | length' .auto-context/anti-patterns.json
jq '[.[] | select(.stage == "active")] | length' .auto-context/anti-patterns.json
jq '[.[] | select(.stage == "observation")] | length' .auto-context/anti-patterns.json

# Reward signal data
jq 'length' .auto-context/rewards.json
jq 'if length > 0 then ([.[].reward_score] | add / length) else null end' .auto-context/rewards.json
jq 'if length >= 5 then [-5:] | [.[].reward_score] else [.[].reward_score] end' .auto-context/rewards.json
jq 'if length > 0 then {implicit_pos: ([.[].implicit_positive] | add), implicit_neg: ([.[].implicit_negative] | add), explicit_pos: ([.[].explicit_positive] | add), explicit_neg: ([.[].explicit_negative] | add)} else null end' .auto-context/rewards.json
```

**Step 3: Replace the Anti-Patterns section in Step 3 (Format Status Dashboard):**

Replace:
```
### Anti-Patterns
- Total: {anti_pattern_count}
```

With:
```
### Anti-Patterns ({active_ap_count} active, {observation_ap_count} pending)
- From explicit feedback: {explicit_ap_count}
- From correction detection: {correction_ap_count}
- From error tracking: {error_ap_count}
- Active (in CLAUDE.md): {active_ap_count}
- Observation (gathering data): {observation_ap_count}
```

**Step 4: Replace the Reward Signals section in Step 3:**

Replace the placeholder:
```
### Reward Signals
- Reward tracking: pending Phase 7
```

With conditional display logic:

If `rewards.json` is missing or empty (length == 0):
```
### Reward Signals
- Reward tracking: no data yet (accumulates over sessions)
```

If `rewards.json` has data:
```
### Reward Signals ({sessions_tracked} sessions)
- Average reward score: {avg_score} (1.0 = perfect, 0.0 = all corrections)
- Implicit signals: {implicit_pos} positive / {implicit_neg} negative
- Explicit signals: {explicit_pos} positive / {explicit_neg} negative
- Recent trend (last 5): {score1}, {score2}, ...
  Trend: {improving if last > first, stable if equal within 0.1, declining if last < first}
```

For the trend determination, instruct Claude to:
1. Take the recent scores array (last 5 or fewer)
2. Compare the first and last values
3. If last - first > 0.1: "improving"
4. If first - last > 0.1: "declining"
5. Otherwise: "stable"

**Important constraints:**
- This is a SKILL.md file (prompt for Claude, not executable code). Write clear instructions that Claude will follow when a user runs `/ac-status`.
- Maintain `disable-model-invocation: true` in frontmatter.
- Keep the skill **read-only** -- never modify data files.
- Handle missing `rewards.json` gracefully (file may not exist if no sessions have completed with the Phase 7 agent).
- Handle missing `.source` field in anti-patterns.json entries gracefully (Phase 4 entries may not have explicit source field -- treat missing source as "explicit" since Phase 4 only writes explicit anti-patterns).
- Use `// 0` jq fallback for null numeric fields.
- Round reward scores to 2 decimal places in display: use `jq` with `* 100 | floor / 100` pattern.
  </action>
  <verify>
    <automated>grep -q "Reward Signals" skills/ac-status/SKILL.md && grep -q "rewards.json" skills/ac-status/SKILL.md && grep -q "correction" skills/ac-status/SKILL.md && ! grep -q "pending Phase 7" skills/ac-status/SKILL.md && echo "PASS" || echo "FAIL"</automated>
    <manual>Read skills/ac-status/SKILL.md and verify: (1) rewards.json in file list, (2) jq commands for reward aggregation, (3) jq commands for anti-pattern source breakdown, (4) conditional reward display (no data vs data), (5) trend computation logic, (6) placeholder "pending Phase 7" removed, (7) skill remains read-only</manual>
  </verify>
  <done>/ac-status displays reward signal breakdown (average score, implicit/explicit counts, trend) and anti-pattern categorization by source (explicit, correction, error) with stage breakdown. The "pending Phase 7" placeholder is removed.</done>
</task>

</tasks>

<verification>
1. `grep "Reward Signals" skills/ac-status/SKILL.md` shows the new section header (not placeholder)
2. `grep -v "pending Phase 7" skills/ac-status/SKILL.md` confirms placeholder removed
3. `grep "rewards.json" skills/ac-status/SKILL.md` shows file reference
4. `grep "correction" skills/ac-status/SKILL.md` shows anti-pattern source breakdown
5. `grep "disable-model-invocation: true" skills/ac-status/SKILL.md` confirms read-only preserved
</verification>

<success_criteria>
- /ac-status SKILL.md includes reward signal section with average score, implicit/explicit counts, and trend
- /ac-status SKILL.md includes anti-pattern breakdown by source (explicit, correction, error) and stage (active, observation)
- The "pending Phase 7" placeholder text is removed
- The skill remains read-only (never modifies data files)
- Missing rewards.json handled gracefully with "no data yet" message
</success_criteria>

<output>
After completion, create `.planning/phases/07-anti-patterns-reward-signals/07-02-SUMMARY.md`
</output>
