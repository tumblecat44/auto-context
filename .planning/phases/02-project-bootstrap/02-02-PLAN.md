---
phase: 02-project-bootstrap
plan: 02
type: execute
wave: 2
depends_on: ["01"]
files_modified:
  - skills/ac-reset/SKILL.md
autonomous: true
requirements: [TRNS-03]

must_haves:
  truths:
    - "/ac-reset skill exists and Claude can follow its teardown instructions"
    - "Running /ac-reset removes .auto-context/ directory completely"
    - "Running /ac-reset removes auto-context marker section from CLAUDE.md without damaging user content"
    - "After reset, CLAUDE.md has no orphaned markers"
  artifacts:
    - path: "skills/ac-reset/SKILL.md"
      provides: "Teardown instructions for clearing auto-context state"
      contains: "name: ac-reset"
      min_lines: 20
  key_links:
    - from: "skills/ac-reset/SKILL.md"
      to: ".auto-context/"
      via: "rm -rf .auto-context/"
      pattern: "rm.*auto-context"
    - from: "skills/ac-reset/SKILL.md"
      to: "CLAUDE.md"
      via: "Remove marker section between auto-context:start and auto-context:end"
      pattern: "auto-context:(start|end)"
---

<objective>
Create the /auto-context:ac-reset skill that cleanly tears down all auto-context state -- removes the .auto-context/ data directory and cleans the auto-context marker section from CLAUDE.md without damaging user content.

Purpose: Users need a clean way to start fresh or uninstall auto-context from a project. The reset must leave CLAUDE.md in a clean state with no orphaned markers or empty sections.

Output: skills/ac-reset/SKILL.md (teardown instructions)
</objective>

<execution_context>
@/Users/dgsw67/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dgsw67/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-project-bootstrap/02-RESEARCH.md
@.planning/phases/02-project-bootstrap/02-01-SUMMARY.md
@scripts/lib/markers.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ac-reset SKILL.md with teardown instructions</name>
  <files>skills/ac-reset/SKILL.md</files>
  <action>
Create `skills/ac-reset/` directory and write `SKILL.md` with YAML frontmatter and teardown instructions.

**Frontmatter:**
```yaml
---
name: ac-reset
description: Clear all auto-context data and remove auto-generated sections from CLAUDE.md. Use to start fresh or uninstall auto-context from a project.
disable-model-invocation: true
---
```

Key frontmatter decisions per research:
- `disable-model-invocation: true` -- destructive action, user must explicitly invoke
- No `context: fork` -- needs to modify project files directly
- No `allowed-tools` restriction -- Claude needs Bash and Write

**SKILL.md body instructions (4 steps):**

**Step 1: Confirm with User**
- Before proceeding, inform the user what will be deleted:
  - `.auto-context/` directory (all conventions, candidates, anti-patterns, config, session logs)
  - Auto-context marker section in CLAUDE.md (content between `<!-- auto-context:start -->` and `<!-- auto-context:end -->`, inclusive of the markers themselves)
- Ask for confirmation to proceed. If user says no, stop.

**Step 2: Remove Data Store**
- Delete the `.auto-context/` directory entirely:
  ```bash
  rm -rf .auto-context/
  ```
- Verify it's gone: `test ! -d .auto-context/ && echo "Data store removed" || echo "WARNING: .auto-context/ still exists"`

**Step 3: Clean CLAUDE.md**
- If CLAUDE.md exists:
  - Remove everything between `<!-- auto-context:start -->` and `<!-- auto-context:end -->` (inclusive of the markers themselves)
  - Use awk for safe multiline removal (consistent with Phase 1 patterns):
    ```bash
    awk '/<!-- auto-context:start -->/{skip=1; next} /<!-- auto-context:end -->/{skip=0; next} !skip{print}' CLAUDE.md > CLAUDE.md.ac-tmp && mv CLAUDE.md.ac-tmp CLAUDE.md
    ```
  - If CLAUDE.md is empty after removal (only whitespace), delete it (it was auto-created by the plugin)
  - If CLAUDE.md has user content remaining, keep it with the marker section removed
  - Verify no orphaned markers remain: `grep -c "auto-context:" CLAUDE.md` should return 0
- If CLAUDE.md does not exist, skip this step

**Step 4: Report Results**
- Tell the user what was cleaned:
  - Whether .auto-context/ was found and removed
  - Whether CLAUDE.md was modified (and how: marker section removed, or file deleted, or no CLAUDE.md found)
  - Suggest running `/auto-context:ac-init` to re-bootstrap if desired

**Important edge cases to handle:**
- .auto-context/ doesn't exist (already clean) -- not an error, just report "no data store found"
- CLAUDE.md doesn't exist -- not an error, just report "no CLAUDE.md found"
- CLAUDE.md exists but has no markers -- leave it untouched, report "no auto-context markers found"
- CLAUDE.md has corrupted markers (missing one) -- still attempt cleanup using grep to remove any lines containing the marker patterns

Keep this skill concise. It's a simple teardown operation -- no need for elaborate instructions. Target 40-80 lines.
  </action>
  <verify>
    <automated>test -f skills/ac-reset/SKILL.md && head -5 skills/ac-reset/SKILL.md | grep -q "name: ac-reset" && echo "PASS: SKILL.md exists with correct frontmatter"</automated>
    <manual>Read SKILL.md and verify it covers all 4 steps, handles edge cases (missing files, corrupted markers), and the awk command correctly removes marker sections</manual>
  </verify>
  <done>SKILL.md exists with valid frontmatter (name: ac-reset, disable-model-invocation: true). Contains confirmation step, data store removal, CLAUDE.md cleanup with orphaned marker prevention, and result reporting. Handles all edge cases: missing directory, missing CLAUDE.md, no markers, corrupted markers.</done>
</task>

<task type="auto">
  <name>Task 2: Validate plugin skills registration and structure</name>
  <files>skills/ac-init/SKILL.md, skills/ac-reset/SKILL.md, skills/ac-init/scripts/discover-commands.sh</files>
  <action>
Validate that both skills are properly structured for the Claude Code plugin system. This task verifies the integration between Phase 2 skills and the Phase 1 plugin scaffold. **Note: This task depends on Plan 02-01 having already created skills/ac-init/SKILL.md and skills/ac-init/scripts/discover-commands.sh.**

1. **Verify directory structure matches plugin spec:**
   ```
   skills/
   ├── ac-init/
   │   ├── SKILL.md
   │   └── scripts/
   │       └── discover-commands.sh
   └── ac-reset/
       └── SKILL.md
   ```
   Run `ls -R skills/` and verify the structure.

2. **Verify SKILL.md frontmatter validity for both skills:**
   - Each SKILL.md must have valid YAML between `---` delimiters
   - Required fields: `name`, `description`
   - Expected fields: `disable-model-invocation: true`
   - Validate by extracting frontmatter with awk and checking fields exist

3. **Verify discover-commands.sh is executable:**
   - `test -x skills/ac-init/scripts/discover-commands.sh` must pass
   - If not executable, run `chmod +x skills/ac-init/scripts/discover-commands.sh`

4. **Run discover-commands.sh on current project to verify it works:**
   - `bash skills/ac-init/scripts/discover-commands.sh .` must exit 0 and produce valid JSON
   - Verify output with `jq '.'`

5. **Remove the skills/.gitkeep file** since the directory now has real content:
   - `rm -f skills/.gitkeep`

6. **Verify plugin.json still references hooks (no changes needed for skills):**
   - Skills are auto-discovered from the `skills/` directory per Claude Code plugin spec
   - Confirm `.claude-plugin/plugin.json` is unchanged and valid: `jq '.' .claude-plugin/plugin.json`
  </action>
  <verify>
    <automated>ls -R skills/ && bash skills/ac-init/scripts/discover-commands.sh . | jq '.' > /dev/null && echo "PASS: structure valid, script produces valid JSON"</automated>
    <manual>Confirm skills directory has no .gitkeep and both SKILL.md files have valid frontmatter</manual>
  </verify>
  <done>Both skills properly structured per Claude Code plugin spec. discover-commands.sh executable and produces valid JSON. skills/.gitkeep removed. Plugin structure is complete with hooks/ (Phase 1) and skills/ (Phase 2) directories.</done>
</task>

</tasks>

<verification>
1. `skills/ac-reset/SKILL.md` exists with valid YAML frontmatter
2. SKILL.md includes confirmation step before destructive operations
3. SKILL.md handles all edge cases: missing .auto-context/, missing CLAUDE.md, no markers, corrupted markers
4. No orphaned markers after reset (awk command removes both markers and content between them)
5. Both skills discoverable from skills/ directory structure
6. discover-commands.sh is executable and produces valid JSON
7. Plugin structure complete: .claude-plugin/plugin.json + hooks/ + skills/
</verification>

<success_criteria>
- /auto-context:ac-reset skill cleanly removes .auto-context/ directory and CLAUDE.md marker section
- Reset handles all edge cases without errors (missing files, corrupted markers)
- User content in CLAUDE.md is preserved when markers are removed
- Both Phase 2 skills (ac-init, ac-reset) are properly structured in the skills/ directory
- Plugin validation passes with the new skills directory structure
</success_criteria>

<output>
After completion, create `.planning/phases/02-project-bootstrap/02-02-SUMMARY.md`
</output>
